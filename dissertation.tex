%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode

\documentclass[oneside,School=Harvard]{Dissertate}

\geometry{
    a4paper,
    margin=1in,
    %showframe=true,
}

\usepackage[export]{adjustbox}
\usepackage{color}
\usepackage{csquotes}
\usepackage{excludeonly}
\usepackage{fancyvrb}
\usepackage{imakeidx}
\usepackage{listings}
\usepackage{microtype}
\usepackage{multicol}
\usepackage{pdfpages}
\usepackage{textcomp}
\usepackage[color=yellow]{todonotes}

\usepackage[
    labelfont={sc,scriptsize},
    textfont={rm,scriptsize},
    singlelinecheck=off,
]{caption}

%\usepackage[margincaption,outercaption,raggedright]{sidecap}
%\sidecaptionvpos{figure}{t} 
%\sidecaptionvpos{table}{t}

\usepackage{sidenotes}

\newenvironment{markdown}{
    \VerbatimEnvironment
    \begin{VerbatimOut}{tmp/tmp.markdown}%
}{  
    \end{VerbatimOut}
    \immediate\write18{pandoc tmp/tmp.markdown -t latex -o tmp/tmp.tex}
    \input{tmp/tmp.tex}
}

\definecolor{bluekeywords}{rgb}{0.13,0.13,1}
\definecolor{greencomments}{rgb}{0,0.5,0}
\definecolor{redstrings}{rgb}{0.9,0,0}
\definecolor{grey}{rgb}{0.5,0.5,0.5}
\definecolor{lightgrey}{rgb}{0.75,0.75,0.75}

\lstset{
    basicstyle=\scriptsize\ttfamily,
    breakatwhitespace=false,
    breaklines=false,
    commentstyle=\color{greencomments},
    escapeinside={(*@}{@*)},
    frame=l,
    framerule=1.5pt,
    framesep=6pt,
    keywordstyle=\color{bluekeywords}\bfseries,
    language=Python,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stringstyle=\color{redstrings},
    upquote=true,
}

\lstdefinestyle{beep}{
    language=[LaTeX]TeX,
}

\includeonly{
%    source/chapters/introduction,
%    source/chapters/a-model-of-notation,
    source/chapters/time-tools,
    source/chapters/a-model-of-composition,
%    source/chapters/practicalities,
%    source/chapters/conclusion,
}

%\excludeonly{
%    source/chapters/score-aurora,
%    source/chapters/score-plague-water,
%    source/chapters/score-zaira,
%    source/chapters/score-armilla,
%    source/chapters/score-ersilia,
%}

\makeindex[columns=3, title=Index, intoc]

\begin{document}

\frontmatter
\pagenumbering{roman}
\input{source/frontmatter/personalize}
\maketitle
%\copyrightpage
%\abstractpage
\tableofcontents
%\listoffigures
%\dedicationpage
%\acknowledgments

\mainmatter
\doublespacing
\cleardoublepage
\pagenumbering{arabic}
\setcounter{page}{1}
\setcounter{chapter}{-1}

\include{source/chapters/introduction}
\include{source/chapters/a-model-of-notation}
\include{source/chapters/time-tools}
\include{source/chapters/a-model-of-composition}
\include{source/chapters/practicalities}
\include{source/chapters/score-aurora}
\include{source/chapters/score-plague-water}
\include{source/chapters/score-zaira}
\include{source/chapters/score-armilla}
\include{source/chapters/score-ersilia}
\include{source/chapters/conclusion}

\lstset{
    basicstyle=\scriptsize\ttfamily,
    breakatwhitespace=false,
    breaklines=false,
    commentstyle=\color{greencomments},
    escapeinside={(*@}{@*)},
    keywordstyle=\color{bluekeywords}\bfseries,
    language=Python,
    frame=none,
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{grey},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stringstyle=\color{redstrings},
    upquote=true,
}

\singlespacing
\begin{appendices}
    \include{source/appendices/appendices}
\end{appendices}

%\cleardoublepage
%\printindex

%\cleardoublepage
%\addcontentsline{toc}{chapter}{References}
%\bibliographystyle{apalike2}
%\bibliography{references}

%\include{source/endmatter/colophon}

\end{document}