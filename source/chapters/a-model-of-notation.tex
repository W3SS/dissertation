%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{\emph{Abjad}: a model of notation}
\label{chap:a-model-of-notation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Abjad models notation.

\section{Representing objects}

\begin{comment}
-   print()
-   repr() and \_\_repr\_\_()
-   str() and \_\_str\_\_()
-   format() and \_\_format\_\_()
-   show() and \_\_illustrate\_\_()
-   graph() and \_\_graph\_\_()
\end{comment}

\section{Components, indicators \& spanners}

Abjad models notated musical scores as a \emph{tree} consisting of
\emph{components}, \emph{indicators} and \emph{spanners}. All objects appearing
in a score fall into one of those three categories.

\section{Components}

Components make up the \emph{nodes} of the score tree, treating the score as an
acyclic directed rooted graph, or \emph{arborescence}, rooted on a single
component. All components inherit from Abjad's \texttt{Component} class, which
encapsulates logic crucial to maintaining the correctness of the score tree,
and affords behaviors common to all component subclasses including
illustrability, formattability and naming. Abjad divides score components into
\emph{containers} -- those components which may contain other other components,
such as staves, voices, tuplets, measures and so forth -- and \emph{leaves} --
those components which may contain no other components, such as notes, chords
and rests, as well as LilyPond's multi-measure rests and non-printing
typographic \emph{skips}. Additionally, components can each be instantiated
from a variety of input, from parsable LilyPond syntax strings to parametric
arguments -- both numeric and explicitly object-modeled via pitch and duration
objects. For example, we can instantiate and illustrate a middle-C quarter
note:

\begin{comment}
<abjad>
note = Note("c'4")
show(note)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> note = Note("c'4")
>>> show(note)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-c018a545d264ff34225e9a3a5babb6c1.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\noindent a half-note rest:

\begin{comment}
<abjad>
rest = Rest((1, 2))
show(rest)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> rest = Rest((1, 2))
>>> show(rest)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-8144dc38435e18921a5d584ad635d2e3.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\noindent and a D-minor chord:

\begin{comment}
<abjad>
chord = Chord([2, 5, 9], Duration(1, 4))
show(chord)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> chord = Chord([2, 5, 9], Duration(1, 4))
>>> show(chord)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-fef850f162448b1e8d3c6be53e362436.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\noindent Note above that the LilyPond output shows a \sfrac{4}{4} time
signature even though none of the created leaves takes up an whole note's
duration. LilyPond simply treats all music as \sfrac{4}{4} unless explicitly
instructed otherwise. We can make the \sfrac{4}{4} time signature explicit by
instantiating a \sfrac{4}{4} measure to contain the above three leaf instances:

\begin{comment}
<abjad>
measure = Measure((4, 4), [note, rest, chord])
show(measure)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> measure = Measure((4, 4), [note, rest, chord])
>>> show(measure)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-cad7b59ce37e423c6cdc4729377818c7.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\subsection{Containers}

Abjad's containers implement Python's \emph{mutable sequence protocol},
allowing them to be used transparently as though they were lists. Components
can be appended, extended, or inserted into a container and that container can
also be indexed into, measured for length and iterated over. For example, the
second component contained by the measure can be retrieved by subscripting the
measure with the index 1:

\begin{comment}
<abjad>
measure[1]
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> measure[1]
Rest('r2')
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

That second component -- the half-note rest -- can be replaced by
another container, a triplet:

\begin{comment}
<abjad>
outer_tuplet = Tuplet((2, 3), "a'4 b4 cs'4")
measure[1] = outer_tuplet
show(measure)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> outer_tuplet = Tuplet((2, 3), "a'4 b4 cs'4")
>>> measure[1] = outer_tuplet
>>> show(measure)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-f9a8a92bd9dbe5f480a4003ade9c81aa.pdf}
\end{singlespacing}
\end{abjadbookoutput}

Furthermore, the last two leaves in the triplet can be replaced by a quintuplet
using Python's \emph{slice assignment} syntax. In the following code, the text
\texttt{outer\_tuplet[1:]} references the selection of components in the
original triplet starting from the second component and going \enquote{to the
end} -- effectively the second and third item, as there are only three. That
selection is then replaced by a list containing a quintuplet, substituting the
contents of one sequence of components for the contents of another.

\begin{comment}
<abjad>
inner_tuplet = Tuplet((4, 5), "b'8 a'8. g'16 f'8.. e'32")
outer_tuplet[1:] = [inner_tuplet]
show(measure)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> inner_tuplet = Tuplet((4, 5), "b'8 a'8. g'16 f'8.. e'32")
>>> outer_tuplet[1:] = [inner_tuplet]
>>> show(measure)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-958463d38eb75b71ce0e7aaa2b9ae94e.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\noindent Iterating over the contents of the \sfrac{4}{4} measure yields only
the top-most components in that container -- its immediate children:

\begin{comment}
<abjad>
for component in measure:
    component

</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> for component in measure:
...     component
...
Note("c'4")
Tuplet(Multiplier(2, 3), "a'4 { 4/5 b'8 a'8. g'16 f'8.. e'32 }")
Chord("<d' f' a'>4")
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

\noindent To retrieve all of the leaves of a container, recursion must be used,
as any container may contain other containers, and those in turn still more
containers. To mitigate this complexity, every container provides a
\texttt{select\_leaves()} method, which returns a selection of the bottom-most
leaf instances in the subtree rooted at that container:

\begin{comment}
<abjad>
for leaf in measure.select_leaves():
    leaf

</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> for leaf in measure.select_leaves():
...     leaf
...
Note("c'4")
Note("a'4")
Note("b'8")
Note("a'8.")
Note("g'16")
Note("f'8..")
Note("e'32")
Chord("<d' f' a'>4")
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

Note that Abjad's \texttt{Chord} class aggregates multiple \emph{note heads}
rather than notes. Likewise Abjad's \texttt{Note} class aggregates a single
note head. While chords implement containment in terms of note heads --
delegating to a dedicated note head inventory -- they are not themselves
"containers" in the same sense that a voice, measure or tuplet are containers.
It is important here to differentiate between the concept of a \enquote{chord}
as a single duration paired with a collection of pitches and a \enquote{chord}
as the sounding sonority at some given point in a piece spread over some number
of voices. Abjad always makes use of the former rather than the latter.

\begin{comment}
<abjad>
note_head_inventory = chord.note_heads
for note_head in note_head_inventory:
    note_head

chord.note_heads.append(NamedPitch("c''"))
show(chord)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> note_head_inventory = chord.note_heads
>>> for note_head in note_head_inventory:
...     note_head
...
NoteHead("d'")
NoteHead("f'")
NoteHead("a'")
\end{lstlisting}
\begin{lstlisting}
>>> chord.note_heads.append(NamedPitch("c''"))
>>> show(chord)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-0419b405f12cba5bff2e20c17c72e860.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\subsection{Parentage}

The container that contains a given component is called its \emph{parent}, and
the components contained in a container are known as that container's
\emph{children}. Every component may have one and only one parent container,
although a component may also have no parent -- a null parent reference. Any
component whose parent is null is necessarily the root of its own score tree.
Furthermore, no component may appear in its own \emph{proper parentage} -- the
sequence of components comprising the unique path from a given component to the
root of its tree, excepting the component itself -- as this would induce
reference cycles within the score tree.

Abjad object-models the concept of parentage explicitly as a \texttt{Parentage}
\emph{selection} class, accessible via the \emph{inspector} which exposes a
given component's \emph{inspection interface}: a collection of methods for
accessing information about that component, many of which depend on that
component's position within the score hierarchy, including the component's
parentage or duration. An inspector can be instantiated by calling Abjad's
top-level \texttt{inspect\_()} function on a component.\footnote{Abjad uses
\texttt{inspect\_()} rather than \texttt{inspect()} as Python already provides
an \texttt{inspect} module for object introspection, and it is considered bad
practice to overwrite names of functions, classes or modules found in the
standard library such as \texttt{set} or \texttt{object}. When a name conflict
would occur, projects traditionally append an underscore to the name they wish
to use.} Consider the parentage for the first eighth note of the inner tuplet.
Its parentage -- \emph{improper} by default -- includes itself, its immediate
quintuplet parent, its triplet grandparent and the \sfrac{4}{4} measure as its
great-grandparent:

\begin{comment}
<abjad>
inner_b_eighth = measure[1][1][0]
inspector = inspect_(inner_b_eighth)
parentage = inspector.get_parentage()
parentage.parent
for component in parentage:
    component

</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> inner_b_eighth = measure[1][1][0]
>>> inspector = inspect_(inner_b_eighth)
>>> parentage = inspector.get_parentage()
>>> parentage.parent
Tuplet(Multiplier(4, 5), "b'8 a'8. g'16 f'8.. e'32")
\end{lstlisting}
\begin{lstlisting}
>>> for component in parentage:
...     component
...
Note("b'8")
Tuplet(Multiplier(4, 5), "b'8 a'8. g'16 f'8.. e'32")
Tuplet(Multiplier(2, 3), "a'4 { 4/5 b'8 a'8. g'16 f'8.. e'32 }")
Measure((4, 4), "c'4 { 2/3 a'4 { 4/5 b'8 a'8. g'16 f'8.. e'32 } } <d' f' a' c''>4")
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

By default, every component's parent is null.

\begin{comment}
<abjad>
whole_note = Note("c'1")
inspector = inspect_(whole_note)
inspector.get_parentage().parent is None
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> whole_note = Note("c'1")
>>> inspector = inspect_(whole_note)
>>> inspector.get_parentage().parent is None
True
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

Inserting the above whole note into a container sets the whole note's parent
to that container. Additionally, the container is now aware that it contains
the whole note, demonstrating the bi-directional references inherent to Abjad's
score tree model:

\begin{comment}
<abjad>
container_one = Container()
container_one.append(whole_note)
inspector.get_parentage().parent is container_one
whole_note in container_one
print(format(container_one))
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> container_one = Container()
>>> container_one.append(whole_note)
>>> inspector.get_parentage().parent is container_one
True
\end{lstlisting}
\begin{lstlisting}
>>> whole_note in container_one
True
\end{lstlisting}
\begin{lstlisting}
>>> print(format(container_one))
{
    c'1
}
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

Inserting the same whole note into a different container removes it from the
first, demonstrating that components can only exist in one container at a time:

\begin{comment}
<abjad>
container_two = Container()
container_two.append(whole_note)
inspector.get_parentage().parent is container_two
whole_note in container_two
whole_note in container_one
print(format(container_two))
print(format(container_one))
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> container_two = Container()
>>> container_two.append(whole_note)
>>> inspector.get_parentage().parent is container_two
True
\end{lstlisting}
\begin{lstlisting}
>>> whole_note in container_two
True
\end{lstlisting}
\begin{lstlisting}
>>> whole_note in container_one
False
\end{lstlisting}
\begin{lstlisting}
>>> print(format(container_two))
{
    c'1
}
\end{lstlisting}
\begin{lstlisting}
>>> print(format(container_one))
{
}
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

Likewise, while the first container can be inserted into the second, the second
container cannot be inserted back into the first. Such an arrangement would
cause the second container to become its own grandparent, and therefore
generates an error:

\begin{comment}
<abjad>[allow_exceptions]
container_two.append(container_one)
container_one.append(container_two)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> container_two.append(container_one)
>>> container_one.append(container_two)
Traceback (most recent call last):
  File "<abjadbook>", line 1, in <module>
  File "/Users/josiah/Documents/Development/abjad/abjad/tools/scoretools/Container.py", line 922, in append
    self.__setitem__(slice(len(self), len(self)), [component])
  File "/Users/josiah/Documents/Development/abjad/abjad/tools/scoretools/Container.py", line 130, in __setitem__
    return self._set_item(i, expr)
  File "/Users/josiah/Documents/Development/abjad/abjad/tools/scoretools/Container.py", line 441, in _set_item
    raise ParentageError('Attempted to induce cycles.')
ParentageError: Attempted to induce cycles.
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

\subsection{Duration}

Every component may be expressed in terms of their duration, as well as their
start offset relative to the score origin and, by extension, their timespan --
the span of time bounded by their start offset and their stop offset.

The duration of each leaf derives from the product of its \emph{written
duration} -- a duration representing the actual glyphs used in the score as
represented by some combination of note heads, stems, beams and dots -- and
their \emph{prolation} -- the cumulative product of all of the duration
multipliers of the containers in a component's proper parentage.

Consider again the B eighth-note starting the inner tuplet. Its parentage
provides its prolation:

\begin{comment}
<abjad>
inspect_(inner_b_eighth).get_parentage().prolation
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> inspect_(inner_b_eighth).get_parentage().prolation
Multiplier(8, 15)
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

By multiplying each leaf's written duration by its prolation, we can determine
that leaf's actual, or prolated, duration. Note too that this conforms to the
results of the inspector's \texttt{get\_duration()} method:

\begin{comment}
<abjad>
for leaf in measure.select_leaves():
    inspector = inspect_(leaf)
    written_duration = leaf.written_duration
    prolation = inspector.get_parentage().prolation
    actual_duration = inspector.get_duration()
    string = '{!s}: {!s} * {!s} = {!s}'
    string = string.format(leaf, written_duration, prolation, actual_duration)
    print(string)

</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> for leaf in measure.select_leaves():
...     inspector = inspect_(leaf)
...     written_duration = leaf.written_duration
...     prolation = inspector.get_parentage().prolation
...     actual_duration = inspector.get_duration()
...     string = '{!s}: {!s} * {!s} = {!s}'
...     string = string.format(leaf, written_duration, prolation, actual_duration)
...     print(string)
...
c'4: 1/4 * 1 = 1/4
a'4: 1/4 * 2/3 = 1/6
b'8: 1/8 * 8/15 = 1/15
a'8.: 3/16 * 8/15 = 1/10
g'16: 1/16 * 8/15 = 1/30
f'8..: 7/32 * 8/15 = 7/60
e'32: 1/32 * 8/15 = 1/60
<d' f' a' c''>4: 1/4 * 1 = 1/4
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

Written durations must be \emph{assignable}. Assignability describes the set of
durations describable in Western common practice notation solely through
combining a single note head, its flags and dots, without recourse to ties or
tuplets. Any rational duration $\sfrac{n}{d}$ is considered assignable when and
only when it adheres to the form

\begin{equation}
{ 2^k * (2^u - j) \over 2^v }
\end{equation}

\noindent where $u$, $v$ and $k$ are nonnegative integers, $j \leq
u$ and $j$ is either 1 or 0.

Assignability guarantees that a duration's denominator is always a positive
power-of-two integer, such as 1, 2, 4, 8, 16 and so forth, and therefore
precludes durations such as $\sfrac{1}{3}$ or $\sfrac{2}{5}$. Likewise,
assignability permits numerators such as 1, 2, 3, 4, 6, 7, 8, 12, 14 and 15 but
forbids 5, 9, 10, 13 and 17, as they imply ties.

More elegantly, any integer can be considered if its binary representation does
not contain the substring \enquote{01}:

\begin{comment}
<abjad>
for i in range(17):
    binary_string = mathtools.integer_to_binary_string(i)
    is_assignable = mathtools.is_assignable_integer(i)
    string = '{}: {} [{}]'.format(i, binary_string, is_assignable)
    print(string)

</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> for i in range(17):
...     binary_string = mathtools.integer_to_binary_string(i)
...     is_assignable = mathtools.is_assignable_integer(i)
...     string = '{}: {} [{}]'.format(i, binary_string, is_assignable)
...     print(string)
...
0: 0 [False]
1: 1 [True]
2: 10 [True]
3: 11 [True]
4: 100 [True]
5: 101 [False]
6: 110 [True]
7: 111 [True]
8: 1000 [True]
9: 1001 [False]
10: 1010 [False]
11: 1011 [False]
12: 1100 [True]
13: 1101 [False]
14: 1110 [True]
15: 1111 [True]
16: 10000 [True]
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

The duration of each container then derives from the product of its prolation
and its *contents duration* -- the sum of the durations of its children.
Ultimately, all scores derive their durations from the durations of their
leaves, prolated as necessary by any tuplets.

-   Demonstrate offsets and timespans

-   Demonstrate that these change when new objects are inserted

-   Demonstrate multipliers

\begin{comment}
<abjad>
multimeasure_rest = scoretools.MultimeasureRest(1)
inspect_(multimeasure_rest).get_duration()
show(multimeasure_rest)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> multimeasure_rest = scoretools.MultimeasureRest(1)
>>> inspect_(multimeasure_rest).get_duration()
Duration(1, 1)
\end{lstlisting}
\begin{lstlisting}
>>> show(multimeasure_rest)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-099f7141431afa5ae3a046415764f35b.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
show(multimeasure_rest)
attach(Multiplier(4), multimeasure_rest)
inspect_(multimeasure_rest).get_duration()
show(multimeasure_rest)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> show(multimeasure_rest)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-099f7141431afa5ae3a046415764f35b.pdf}
\begin{lstlisting}
>>> attach(Multiplier(4), multimeasure_rest)
>>> inspect_(multimeasure_rest).get_duration()
Duration(4, 1)
\end{lstlisting}
\begin{lstlisting}
>>> show(multimeasure_rest)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-a8fdc5cae1a0a9fb72680a5d18862c4e.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
-   Every component may be named.
-   components, leaves, containers (and contexts)
-   components are formattable and illustrable
-   components are mutable, while indicators are generally not
    -   likewise, durations and pitches are immutable

-   count-time components
    -   note, chord, rest, skip, container, tuplet, measure
-   non-count-time (contexts)
    -   voice, staff, staff group, score

-   leaves do not contain anything else
    -   chord do *not* contain notes
    -   chords and notes contain note heads
    -   chord and notes share a single stem
    -   this must be disambiguated from note columns

-   all containers derive their duration from their contents (with some
    exceptions, but even there a mismatch is an error)
-   written duration, prolated duration, pre-prolated duration, contents
    duration

-   One, and only one, parent per component. They *cannot* be in more than one
    container. This is both confusing, and liable to cause reference problems.
-   score hierarchy is not fixed: any node is the root, if it has no parent

-   contexts are assumed to last from the beginning to the end of the total
    timespan of the score, but in practice they may be intermittent
-   contexts may be named, allowing concatenation

-   Leaves reside at the "bottom" of the score hierarchy.

Work aspects of this into appropriate sections

-   inspect_()
-   not *inspect()*, as that would cause a name conflict with Python's inspect
    module
-   inspect(...).get_parentage()
-   inspect_(...).get_duration()
    -   in_seconds=True
-   inspect_(...).get_timespan()
    -   in_seconds=True
\end{comment}

\section{Indicators}

\subsection{Attachment}

\subsection{Scope}

\begin{comment}
Indicators attach to individual components
-   some have notational reality
-   some have context scope
-   but they can be totally arbitrary
-   attach(x, y, scope=..., is_annotation=..., name=...)
-   Articulation
-   BarLine
-   Clef
-   Dynamic
-   KeySignature
-   Markup
-   Tempo
-   TimeSignature
-   What is scope?
-   Default scope
-   Explicit scope
-   Idiomatic indicators, used by other processes:
    -   BowContactPoint
    -   IsAtSoundingPitch
    -   IsUnpitched
    -   StringContactPoint
    -   StringTuning
    -   etc.
-   Annotation
-   attach(x, y, is_annotation=True)
-   inspect_(...).get_indicator()
-   inspect_(...).has_indicator()
-   inspect_(...).get_effective()
-   inspect_(...).has_effective_indicator()
\end{comment}

\section{Spanners}

\begin{comment}
Spanners *span* across different levels of hierarchy.
-   logical voices
-   attach to
-   graph cyclicity
-   Beam
-   Glissando
-   Hairpin
-   Slur
-   Trill
-   Tie
-   typographic overrides
# Typographic overrides
-   On components
    - \\override & \\revert
-   On spanners
# Modeling time
-   Duration
-   Offset
-   Multiplier
-   Timespan
-   Prolation
-   Pre-prolated durations
-   Contents duration
\end{comment}

\section{Representing pitches}

\begin{comment}
## Pitch representations
-   The most important distinction is between *named* and *numbered* pitch
    objects.
-   All pitched score components (notes and chords) rely on *named*
    representations of pitch, not numbered
-   *Named* pitch objects are enharmonically explicit
-   *Numbered* pitch objects require some interpretation
-   Abjad has provided one interpretation, but that is for sufficiency
-   Abjad does *not* make smart guesses about converting numbered to named
    pitches
-   NamedPitch
-   NumberedPitch
-   NamedPitchClass
-   NumberedPitchClass
-   NamedInterval
-   NumberedInterval
-   NamedIntervalClass
-   NumberedIntervalClass
-   NamedInversionEquivalentIntervalClass
-   NumberedInversionEquivalentIntervalClass
## Pitch collections
-   Set, Segment, Vector
-   Pitch, PitchClass, Interval, IntervalClass
-   PitchSegment
-   PitchClassSegment
## Pitch operators
## Other pitch modeling concepts
-   Accidental
-   Octave
-   PitchRange
-   StaffPosition
## Inspecting leaf pitches
-   Note("c'4").written_pitch
-   Note("c'4").note_head.written_pitch
-   Chord("<c' e' g'>4").written_pitches
-   inspect_(note).get_sounding_pitch()
-   inspect_(note).get_sounding_pitches()
\end{comment}

\section{Selecting components}

\begin{comment}
## Indexing
-   By name
-   By index
-   By slice
## Selection
-   select()
-   Selection class
-   Container.select_leaves()
    -   allow_discontiguous_leaves=True
-   inspect_(...).get_logical_tie()
-   LogicalTie
    -   head
    -   tail
    -   timespan
    -   trivial logical ties
## Iteration
-   By __iter__()
-   By iterate(...)by_...()
    -   by_class()
    -   by_logical_tie()
    -   by_run()
    -   by_timeline()
    -   by_vertical_moment()
    -   depth_first()
## Selectors
-   Demonstrate a gallery of selectors.
    -   by duration
    -   by leaves
    -   by length
    -   by logical tie
    -   by counts (with negative counts too)
\end{comment}

\section{Mutation}

\section{Notation factories}

\begin{comment}
-   rhythm-makers
-   score templates
-   parsers
    -   LilyPond parser
    -   PLY
    -   SchemeParser
    -   RhythmTreeParser
    -   ReducedLyParser
\end{comment}

\section{Examples}

\begin{comment}
<abjad>
upper_voice = Voice(name='Upper Voice')
upper_staff = Staff([upper_voice], name='Upper Staff')
lower_voice_a = Voice(name='Lower Voice A')
lower_voice_b = Voice(name='Lower Voice B')
lower_staff = Staff([lower_voice_a, lower_voice_b], name='Lower Staff')
piano_staff = StaffGroup([upper_staff, lower_staff], context_name='PianoStaff')
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> upper_voice = Voice(name='Upper Voice')
>>> upper_staff = Staff([upper_voice], name='Upper Staff')
>>> lower_voice_a = Voice(name='Lower Voice A')
>>> lower_voice_b = Voice(name='Lower Voice B')
>>> lower_staff = Staff([lower_voice_a, lower_voice_b], name='Lower Staff')
>>> piano_staff = StaffGroup([upper_staff, lower_staff], context_name='PianoStaff')
\end{lstlisting}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
note = Note("fs'4.")
show(note)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> note = Note("fs'4.")
>>> show(note)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-3899aee7438e42c8270d14ffdc03cb30.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
note = Note(6, (3, 8))
show(note)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> note = Note(6, (3, 8))
>>> show(note)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-3899aee7438e42c8270d14ffdc03cb30.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
chord = Chord("<c'' ef'' g''>2")
show(chord)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> chord = Chord("<c'' ef'' g''>2")
>>> show(chord)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-82ef35ebb9d559540a877d9291a02ca8.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
chord = Chord((12, 15, 19), (1, 2))
show(chord)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> chord = Chord((12, 15, 19), (1, 2))
>>> show(chord)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-82ef35ebb9d559540a877d9291a02ca8.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
rest = Rest("r4")
show(rest)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> rest = Rest("r4")
>>> show(rest)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-78f6872e9c498f4e522a51716ff458dd.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
rest = Rest((1, 4))
show(rest)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> rest = Rest((1, 4))
>>> show(rest)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-78f6872e9c498f4e522a51716ff458dd.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
skip = scoretools.Skip(1)
show(skip)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> skip = scoretools.Skip(1)
>>> show(skip)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-23f5992f0758dbf9cdee4ac0a923bc09.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
note.note_head
note.note_head.is_cautionary = True
show(note)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> note.note_head
NoteHead("fs'")
\end{lstlisting}
\begin{lstlisting}
>>> note.note_head.is_cautionary = True
>>> show(note)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-cb1badca7eef4417a7ce0afba8009a29.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
for note_head in chord.note_heads:
    note_head

chord.note_heads.append("a'")
show(chord)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> for note_head in chord.note_heads:
...     note_head
...
NoteHead("c''")
NoteHead("ef''")
NoteHead("g''")
\end{lstlisting}
\begin{lstlisting}
>>> chord.note_heads.append("a'")
>>> show(chord)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-f6ffc8242c578f619b7b053e9eab2333.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
pitch_segment = pitchtools.PitchSegment("c' ef' b' bf' f' e' b a")
show(pitch_segment)
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> pitch_segment = pitchtools.PitchSegment("c' ef' b' bf' f' e' b a")
>>> show(pitch_segment)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-98c254b3bf3525db1108455a9eb836a7.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
transposition = pitchtools.Transposition(1)
show(transposition(pitch_segment))
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> transposition = pitchtools.Transposition(1)
>>> show(transposition(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-749c176dfaf42985bd3b0d224300b46a.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
inversion = pitchtools.Inversion()
show(inversion(pitch_segment))
inversion_with_axis = pitchtools.Inversion(axis=NamedPitch("d'"))
show(inversion_with_axis(pitch_segment))
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> inversion = pitchtools.Inversion()
>>> show(inversion(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-f5dccecbacdc176c5636cb8662091fbd.pdf}
\begin{lstlisting}
>>> inversion_with_axis = pitchtools.Inversion(axis=NamedPitch("d'"))
>>> show(inversion_with_axis(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-3788337f7ed0f9f5205ea317fef25ba7.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
retrogression = pitchtools.Retrogression()
show(retrogression(pitch_segment))
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> retrogression = pitchtools.Retrogression()
>>> show(retrogression(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-deb23384afe7501bded563186defeabd.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
untransposing_rotation = pitchtools.Rotation(-1, transpose=False)
show(untransposing_rotation(pitch_segment))
transposing_rotation = pitchtools.Rotation(-1, transpose=True)
show(transposing_rotation(pitch_segment))
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> untransposing_rotation = pitchtools.Rotation(-1, transpose=False)
>>> show(untransposing_rotation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-a64fe671be8f551e1d653f00a83a2e07.pdf}
\begin{lstlisting}
>>> transposing_rotation = pitchtools.Rotation(-1, transpose=True)
>>> show(transposing_rotation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-7bd7aa6d7685f24919cad726cee57c04.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
multiplication = pitchtools.Multiplication(3)
show(multiplication(pitch_segment))
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> multiplication = pitchtools.Multiplication(3)
>>> show(multiplication(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-ea43de43da8ed2236bf38e48fab7ca25.pdf}
\end{singlespacing}
\end{abjadbookoutput}

\begin{comment}
<abjad>
pitch_operation = pitchtools.PitchOperation(
    operators=(
        pitchtools.Rotation(1),
        pitchtools.Transposition(2),
        ),
    )
show(pitch_operation(pitch_segment))
</abjad>
\end{comment}

\begin{abjadbookoutput}
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> pitch_operation = pitchtools.PitchOperation(
...     operators=(
...         pitchtools.Rotation(1),
...         pitchtools.Transposition(2),
...         ),
...     )
>>> show(pitch_operation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-0adc9e231ee227673c0a09c603241ec2.pdf}
\end{singlespacing}
\end{abjadbookoutput}