%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{\emph{Abjad}: a model of notation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{comment}
<abjad>[hide=true]
import collections
import consort
</abjad>
\end{comment}

Abjad models notation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The illustration protocol}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Top-level functions}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Components, leaves \& containers}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{comment}
<abjad>
upper_staff = Staff(name='Upper Staff')
lower_staff = Staff(name='Lower Staff')
staff_group = StaffGroup([upper_staff, lower_staff])
score = Score([staff_group])
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> upper_staff = Staff(name='Upper Staff')
>>> lower_staff = Staff(name='Lower Staff')
>>> staff_group = StaffGroup([upper_staff, lower_staff])
>>> score = Score([staff_group])
\end{lstlisting}
\end{singlespacing}
%%% ABJADBOOK END %%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Durations, offsets \& timespans}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Operations on durations}

\begin{comment}
<abjad>
Duration(1, 2) + Duration(3, 4)
Offset(1, 2) + Duration(3, 4)
Offset(7, 8) - Offset(1, 12)
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> Duration(1, 2) + Duration(3, 4)
Duration(5, 4)
\end{lstlisting}
\begin{lstlisting}
>>> Offset(1, 2) + Duration(3, 4)
Offset(5, 4)
\end{lstlisting}
\begin{lstlisting}
>>> Offset(7, 8) - Offset(1, 12)
Duration(19, 24)
\end{lstlisting}
\end{singlespacing}
%%% ABJADBOOK END %%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Pitches, pitch-classes, intervals and operators}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Pitch representations}

\begin{markdown}
- NamedPitch
- NumberedPitch
- NamedPitchClass
- NumberedPitchClass
\end{markdown}

\begin{markdown}
- NamedInterval
- NumberedInterval
- NamedIntervalClass
- NumberedIntervalClass
- NamedInversionEquivalentIntervalClass
- NumberedInversionEquivalentIntervalClass
\end{markdown}

\subsection{Pitch collections}

\begin{markdown}
- Set, Segment, Vector
- Pitch, PitchClass, Interval, IntervalClass
\end{markdown}

\begin{markdown}
- PitchSegment
- PitchClassSegment
\end{markdown}

\subsection{Pitch operators}

\begin{comment}
<abjad>
pitch_segment = pitchtools.PitchSegment("c' ef' b' bf' f' e' b a")
show(pitch_segment)
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> pitch_segment = pitchtools.PitchSegment("c' ef' b' bf' f' e' b a")
>>> show(pitch_segment)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-98c254b3bf3525db1108455a9eb836a7.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
transposition = pitchtools.Transposition(1)
show(transposition(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> transposition = pitchtools.Transposition(1)
>>> show(transposition(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-749c176dfaf42985bd3b0d224300b46a.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
inversion = pitchtools.Inversion()
show(inversion(pitch_segment))
inversion_with_axis = pitchtools.Inversion(axis=NamedPitch("d'"))
show(inversion_with_axis(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> inversion = pitchtools.Inversion()
>>> show(inversion(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-f5dccecbacdc176c5636cb8662091fbd.pdf}
\begin{lstlisting}
>>> inversion_with_axis = pitchtools.Inversion(axis=NamedPitch("d'"))
>>> show(inversion_with_axis(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-3788337f7ed0f9f5205ea317fef25ba7.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
retrogression = pitchtools.Retrogression()
show(retrogression(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> retrogression = pitchtools.Retrogression()
>>> show(retrogression(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-deb23384afe7501bded563186defeabd.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
untransposing_rotation = pitchtools.Rotation(-1, transpose=False)
show(untransposing_rotation(pitch_segment))
transposing_rotation = pitchtools.Rotation(-1, transpose=True)
show(transposing_rotation(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> untransposing_rotation = pitchtools.Rotation(-1, transpose=False)
>>> show(untransposing_rotation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-a64fe671be8f551e1d653f00a83a2e07.pdf}
\begin{lstlisting}
>>> transposing_rotation = pitchtools.Rotation(-1, transpose=True)
>>> show(transposing_rotation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-7bd7aa6d7685f24919cad726cee57c04.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
multiplication = pitchtools.Multiplication(3)
show(multiplication(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> multiplication = pitchtools.Multiplication(3)
>>> show(multiplication(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-ea43de43da8ed2236bf38e48fab7ca25.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
pitch_operation = pitchtools.PitchOperation(
    operators=(
        pitchtools.Rotation(1),
        pitchtools.Transposition(2),
        ),
    )
show(pitch_operation(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> pitch_operation = pitchtools.PitchOperation(
...     operators=(
...         pitchtools.Rotation(1),
...         pitchtools.Transposition(2),
...         ),
...     )
>>> show(pitch_operation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-0adc9e231ee227673c0a09c603241ec2.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\subsection{Other pitch modeling concepts}

\begin{markdown}
- Accidental
- Octave
- PitchRange
- StaffPosition
\end{markdown}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Indicators}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Context scoping}

foo

\subsection{Non-formatting annotations}

foo

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Spanners}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{LilyPond format bundles}

foo

\subsection{Complex conditional formatting}

foo

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Score iteration, selections \& selectors}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Indexing}

foo

\subsection{Iteration}

foo

\subsection{Selection}

foo

\subsection{Selectors}

foo

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notation factories}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Rhythm makers}

foo

\subsection{Score templates}

foo

\subsection{Parsers}

foo