%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{\emph{Abjad}: a model of notation}
\label{chap:a-model-of-notation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{comment}
<abjad>[hide=true]
import collections
import consort
</abjad>
\end{comment}

Abjad models notation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The illustration protocol}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\begin{markdown}
-   print()
-   repr() and __repr__()
-   str() and __str__()
-   format() and __format__()
-   show() and __illustrate__()
-   graph() and __graph__()
\end{markdown}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Components, leaves \& containers}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{markdown}
-   The score tree
-   Component
-   Count-time components
-   Non-count-time components
-   One, and only one, parent per component. They *cannot* be in more than one
    container. This is both confusing, and liable to cause reference problems.
\end{markdown}

\subsection{Leaves}

\begin{markdown}
-   Leaf
-   These are components which do not contain other components.
-   Note
-   Rest
-   Chord
-   NoteHead
\end{markdown}

\subsection{Containers}

\begin{markdown}
-   Container
-   LilyPond and { }
-   Measure
-   LilyPond has no explicit measures
-   Tuplet and FixedDurationTuplet
\end{markdown}

\subsection{Contexts}

\begin{markdown}
-   Context
-   Contexts are containers, but not *count-time*
-   Voice
-   Staff
-   StaffGroup
-   Score
\end{markdown}

\subsection{Inspection}

\begin{markdown}
-   inspect_()
-   not *inspect()*, as that would cause a name conflict with Python's inspect
    module
-   inspect(...).get_parentage()
\end{markdown}

\begin{comment}
<abjad>
upper_staff = Staff(name='Upper Staff')
lower_staff = Staff(name='Lower Staff')
staff_group = StaffGroup([upper_staff, lower_staff])
score = Score([staff_group])
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> upper_staff = Staff(name='Upper Staff')
>>> lower_staff = Staff(name='Lower Staff')
>>> staff_group = StaffGroup([upper_staff, lower_staff])
>>> score = Score([staff_group])
\end{lstlisting}
\end{singlespacing}
%%% ABJADBOOK END %%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Durations, offsets \& timespans}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Operations on durations}

\begin{comment}
<abjad>
Duration(1, 2) + Duration(3, 4)
Offset(1, 2) + Duration(3, 4)
Offset(7, 8) - Offset(1, 12)
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> Duration(1, 2) + Duration(3, 4)
Duration(5, 4)
\end{lstlisting}
\begin{lstlisting}
>>> Offset(1, 2) + Duration(3, 4)
Offset(5, 4)
\end{lstlisting}
\begin{lstlisting}
>>> Offset(7, 8) - Offset(1, 12)
Duration(19, 24)
\end{lstlisting}
\end{singlespacing}
%%% ABJADBOOK END %%%

\subsection{Inspecting durations}

\begin{markdown}
-   inspect_(...).get_duration()
-   inspect_(...).get_timespan()
-   in_seconds=True
\end{markdown}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Pitches, pitch-classes, intervals and operators}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Pitch representations}

\begin{markdown}
- NamedPitch
- NumberedPitch
- NamedPitchClass
- NumberedPitchClass
\end{markdown}

\begin{markdown}
- NamedInterval
- NumberedInterval
- NamedIntervalClass
- NumberedIntervalClass
- NamedInversionEquivalentIntervalClass
- NumberedInversionEquivalentIntervalClass
\end{markdown}

\subsection{Pitch collections}

\begin{markdown}
- Set, Segment, Vector
- Pitch, PitchClass, Interval, IntervalClass
\end{markdown}

\begin{markdown}
- PitchSegment
- PitchClassSegment
\end{markdown}

\subsection{Pitch operators}

\begin{comment}
<abjad>
pitch_segment = pitchtools.PitchSegment("c' ef' b' bf' f' e' b a")
show(pitch_segment)
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> pitch_segment = pitchtools.PitchSegment("c' ef' b' bf' f' e' b a")
>>> show(pitch_segment)
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-98c254b3bf3525db1108455a9eb836a7.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
transposition = pitchtools.Transposition(1)
show(transposition(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> transposition = pitchtools.Transposition(1)
>>> show(transposition(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-749c176dfaf42985bd3b0d224300b46a.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
inversion = pitchtools.Inversion()
show(inversion(pitch_segment))
inversion_with_axis = pitchtools.Inversion(axis=NamedPitch("d'"))
show(inversion_with_axis(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> inversion = pitchtools.Inversion()
>>> show(inversion(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-f5dccecbacdc176c5636cb8662091fbd.pdf}
\begin{lstlisting}
>>> inversion_with_axis = pitchtools.Inversion(axis=NamedPitch("d'"))
>>> show(inversion_with_axis(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-3788337f7ed0f9f5205ea317fef25ba7.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
retrogression = pitchtools.Retrogression()
show(retrogression(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> retrogression = pitchtools.Retrogression()
>>> show(retrogression(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-deb23384afe7501bded563186defeabd.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
untransposing_rotation = pitchtools.Rotation(-1, transpose=False)
show(untransposing_rotation(pitch_segment))
transposing_rotation = pitchtools.Rotation(-1, transpose=True)
show(transposing_rotation(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> untransposing_rotation = pitchtools.Rotation(-1, transpose=False)
>>> show(untransposing_rotation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-a64fe671be8f551e1d653f00a83a2e07.pdf}
\begin{lstlisting}
>>> transposing_rotation = pitchtools.Rotation(-1, transpose=True)
>>> show(transposing_rotation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-7bd7aa6d7685f24919cad726cee57c04.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
multiplication = pitchtools.Multiplication(3)
show(multiplication(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> multiplication = pitchtools.Multiplication(3)
>>> show(multiplication(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-ea43de43da8ed2236bf38e48fab7ca25.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\begin{comment}
<abjad>
pitch_operation = pitchtools.PitchOperation(
    operators=(
        pitchtools.Rotation(1),
        pitchtools.Transposition(2),
        ),
    )
show(pitch_operation(pitch_segment))
</abjad>
\end{comment}

%%% ABJADBOOK START %%%
\begin{singlespacing}
\vspace{-0.5\baselineskip}
\begin{lstlisting}
>>> pitch_operation = pitchtools.PitchOperation(
...     operators=(
...         pitchtools.Rotation(1),
...         pitchtools.Transposition(2),
...         ),
...     )
>>> show(pitch_operation(pitch_segment))
\end{lstlisting}
\noindent\includegraphics[max width=\textwidth,]{assets/lilypond-0adc9e231ee227673c0a09c603241ec2.pdf}
\end{singlespacing}
%%% ABJADBOOK END %%%

\subsection{Other pitch modeling concepts}

\begin{markdown}
-   Accidental
-   Octave
-   PitchRange
-   StaffPosition
\end{markdown}

\subsection{Inspecting leaf pitches}

\begin{markdown}
-   Note("c'4").written_pitch
-   Note("c'4").note_head.written_pitch
-   Chord("<c' e' g'>4").written_pitches
-   inspect_(note).get_sounding_pitch()
-   inspect_(note).get_sounding_pitches()
\end{markdown}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Indicators}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Attachment}

\begin{markdown}
-   attach(x, y, scope=..., is_annotation=..., name=...)
\end{markdown}

\subsection{Tour of indicators}

\begin{markdown}
-   Articulation
-   BarLine
-   Clef 
-   Dynamic
-   KeySignature
-   Markup
-   Tempo
-   TimeSignature
\end{markdown}

\subsection{Context scoping}

\begin{markdown}
-   What is scope?
-   Default scope
-   Explicit scope
\end{markdown}

\subsection{Non-formatting annotations}

\begin{markdown}
-   Annotation
-   Idiomatic indicators, used by other processes:
    -   BowContactPoint
    -   IsAtSoundingPitch
    -   IsUnpitched
    -   StringContactPoint
    -   StringTuning
    -   etc.
-   attach(x, y, is_annotation=True)
\end{markdown}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Spanners}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{markdown}
-   graph cyclicity
-   logical voices
\end{markdown}

\subsection{Tour of spanners}

\begin{markdown}
-   Beam
-   Glissando
-   Hairpin
-   Slur
-   Trill
-   Tie
\end{markdown}

\subsection{LilyPond format bundles}

foo

\subsection{Complex conditional formatting}

foo

\subsection{Complex indicators}

\begin{markdown}
-   KeyCluster
\end{markdown}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Score iteration, selections \& selectors}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Indexing}
\label{ssec:indexing}

\begin{markdown}
-   By name
-   By index
-   By slice
\end{markdown}

\subsection{Selection}
\label{ssec:selection}

\begin{markdown}
-   select() 
-   Selection class
-   Container.select_leaves()
    -   allow_discontiguous_leaves=True
-   inspect_(...).get_logical_tie() 
-   LogicalTie
    -   head
    -   tail
    -   timespan
    -   trivial logical ties
\end{markdown}

\subsection{Iteration}
\label{ssec:iteration}

\begin{markdown}
-   By __iter__()
-   By iterate(...)by_...()
    -   by_class()
    -   by_logical_tie()
    -   by_run()
    -   by_timeline()
    -   by_vertical_moment()
    -   depth_first()
\end{markdown}

\subsection{Selectors}
\label{ssec:selectors}

\begin{markdown}
-   Demonstrate a gallery of selectors.
    -   by duration
    -   by leaves
    -   by length
    -   by logical tie
    -   by counts (with negative counts too)
\end{markdown}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notation factories}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

foo

\subsection{Rhythm makers}

foo

\subsection{Score templates}
\label{ssec:score-templates}

\begin{markdown}
-   Simplify score creation process
\end{markdown}

\subsection{Parsers}

\begin{markdown}
-   LilyPond parser
-   PLY
-   SchemeParser
-   RhythmTreeParser
-   ReducedLyParser
\end{markdown}